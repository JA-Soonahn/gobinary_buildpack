#!/bin/bash

BUILD_DIR=$1

TMP_DEST="/tmp/go.1.14.2.tar.gz"
BUILD_DEST="$BUILD_DIR/vendor"
URL="https://dl.google.com/go/go1.14.2.linux-amd64.tar.gz"

mkdir -p $BUILD_DEST
curl -sL -f -o $TMP_DEST $URL
tar -C $BUILD_DEST -xf $TMP_DEST
export PATH=$PATH:$BUILD_DEST/go/bin

cd /app
mkdir -p go/src
ln -s $BUILD_DIR/golang /app/go/src/jetinsight

cd $BUILD_DIR/golang
make
cd ../ext/go_insight/
make
cp go_insight.so ../../lib/go_insight
